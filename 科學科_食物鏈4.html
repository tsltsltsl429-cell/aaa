<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ ¡åœ’é£Ÿç‰©éˆï¼šå‹•æ…‹å¹³è¡¡æ¨¡æ“¬å™¨</title>
    <style>
        :root {
            --bg-color: #f0f7f4;
            --plant-col: #4CAF50; /* ç¶  */
            --bug-col: #FF9800;   /* æ©™ */
            --bird-col: #E91E63;  /* ç´… */
            --cat-col: #673AB7;   /* ç´« */
        }

        body {
            font-family: "Microsoft JhengHei", "PingFang TC", sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            text-align: center;
            color: #333;
        }

        /* æ¨™é¡Œèˆ‡å‹•æ…‹æ¶ˆæ¯ */
        h1 { color: #2e7d32; margin-bottom: 5px; }
        .subtitle { color: #666; margin-bottom: 20px; }
        
        #news-ticker {
            background: #fff;
            padding: 10px;
            border-radius: 50px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: inline-block;
            min-width: 300px;
            color: #d32f2f;
            font-weight: bold;
            margin-bottom: 20px;
            height: 24px;
        }

        /* éŠæˆ²ä¸»å€åŸŸï¼šå››æ¬„ä½ˆå±€ */
        .game-board {
            display: flex;
            justify-content: center;
            align-items: stretch;
            gap: 15px;
            max-width: 1400px;
            margin: 0 auto;
            flex-wrap: nowrap;
        }

        /* æ¯ä¸€æ¬„çš„å¡ç‰‡è¨­è¨ˆ */
        .column {
            flex: 1;
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            transition: transform 0.2s;
            border-top: 8px solid #ccc;
        }

        /* å„è‡ªçš„é¡è‰² */
        .col-plant { border-color: var(--plant-col); }
        .col-bug { border-color: var(--bug-col); }
        .col-bird { border-color: var(--bird-col); }
        .col-cat { border-color: var(--cat-col); }

        .role-name { font-size: 1.1em; color: #777; margin-bottom: 5px; }
        .species-icon { font-size: 4em; display: block; margin: 10px 0; }
        
        /* æ§åˆ¶æŒ‰éˆ• */
        .controls { display: flex; gap: 10px; align-items: center; justify-content: center; margin-bottom: 10px; }
        button.ctrl-btn {
            width: 40px; height: 40px; border-radius: 50%; border: none;
            font-size: 1.5em; cursor: pointer; color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: 0.1s;
        }
        button.ctrl-btn:active { transform: scale(0.9); }
        .btn-plus { background: #4caf50; }
        .btn-minus { background: #f44336; }

        /* æ•¸å­—é¡¯ç¤º */
        .count-display { font-size: 3.5em; font-weight: 800; font-family: 'Arial', sans-serif; margin: 5px 0; }
        .col-plant .count-display { color: var(--plant-col); }
        .col-bug .count-display { color: var(--bug-col); }
        .col-bird .count-display { color: var(--bird-col); }
        .col-cat .count-display { color: var(--cat-col); }

        /* é€²åº¦æ¢ */
        .progress-container {
            width: 100%; height: 12px; background: #eee; border-radius: 6px; overflow: hidden; margin-bottom: 10px;
        }
        .progress-bar { height: 100%; transition: width 0.5s ease-out; }

        /* è¦–è¦ºæ±  (Emoji) */
        .visual-pool {
            width: 100%; height: 100px;
            background: #fafafa; border-radius: 8px; border: 1px solid #eee;
            padding: 5px; overflow: hidden;
            display: flex; flex-wrap: wrap; justify-content: center; gap: 3px;
        }
        .mini-icon { font-size: 1.2em; animation: popIn 0.3s; }

        /* ç®­é ­ */
        .arrow { align-self: center; font-size: 2em; color: #ccc; font-weight: bold; }

        /* å¤–ä¾†å› ç´ æŒ‰éˆ•å€ (Scenarios) */
        .scenario-panel {
            margin-top: 30px;
            padding: 20px;
            background: #e3f2fd;
            border-radius: 15px;
            max-width: 900px;
            margin-left: auto; margin-right: auto;
        }
        .scenario-title { font-size: 1.2em; font-weight: bold; color: #1565c0; margin-bottom: 15px; }
        
        .action-btn {
            padding: 12px 25px; margin: 5px; border: none; border-radius: 8px;
            font-size: 1em; cursor: pointer; color: white; font-weight: bold;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1); transition: transform 0.1s;
        }
        .action-btn:active { transform: translateY(4px); box-shadow: none; }

        .btn-event-1 { background: #ff7043; } /* æ®ºèŸ²åŠ‘ */
        .btn-event-2 { background: #7e57c2; } /* è²“å…¥ä¾µ */
        .btn-event-3 { background: #66bb6a; } /* æ¤æ¨¹ */

        /* æ»…çµ•ç•«é¢ */
        #game-over {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 999;
            display: none; flex-direction: column; justify-content: center; align-items: center; color: white;
        }
        #game-over h2 { color: #ff5252; font-size: 4em; margin: 0; }
        #game-over p { font-size: 1.5em; color: #ccc; max-width: 600px; line-height: 1.6; }
        .restart-btn {
            padding: 15px 40px; font-size: 1.5em; background: #2196F3;
            color: white; border: none; border-radius: 50px; cursor: pointer; margin-top: 20px;
        }

        @keyframes popIn { 0% { transform: scale(0); } 80% { transform: scale(1.2); } 100% { transform: scale(1); } }

        /* RWD */
        @media (max-width: 800px) {
            .game-board { flex-direction: column; align-items: center; }
            .column { width: 90%; margin-bottom: 10px; }
            .arrow { transform: rotate(90deg); margin: 0; }
        }
    </style>
</head>
<body>

    <h1>ğŸ« æ ¡åœ’ç”Ÿæ…‹å¹³è¡¡ï¼šå‹•æ…‹æ¨¡æ“¬</h1>
    <p class="subtitle">æ³¨æ„ï¼šç‰©ç¨®ä¹‹é–“æœƒäº’ç›¸æ•é£Ÿï¼è«‹ä¿æŒç”Ÿæ…‹å¹³è¡¡ã€‚</p>
    
    <div id="news-ticker">ç”Ÿæ…‹è§€å¯Ÿï¼šç³»çµ±å•Ÿå‹•ï¼Œç›®å‰ä¸€åˆ‡å’Œå¹³...</div>

    <div class="game-board">
        <div class="column col-plant">
            <div class="role-name">ç”Ÿç”¢è€…</div>
            <div class="species-icon">ğŸŒ¿</div>
            <div class="controls">
                <button class="ctrl-btn btn-minus" onclick="manualUpdate('plant', -1)">-</button>
                <button class="ctrl-btn btn-plus" onclick="manualUpdate('plant', 1)">+</button>
            </div>
            <div id="num-plant" class="count-display">20</div>
            <div class="progress-container">
                <div id="bar-plant" class="progress-bar" style="background: var(--plant-col); width: 100%;"></div>
            </div>
            <div class="visual-pool" id="pool-plant"></div>
            <div style="color:#666; font-size:0.9em;">æœéµ‘èŠ± / æ¨¹è‘‰</div>
        </div>

        <div class="arrow">â”</div>

        <div class="column col-bug">
            <div class="role-name">åˆç´šæ¶ˆè²»è€…</div>
            <div class="species-icon">ğŸ›</div>
            <div class="controls">
                <button class="ctrl-btn btn-minus" onclick="manualUpdate('bug', -1)">-</button>
                <button class="ctrl-btn btn-plus" onclick="manualUpdate('bug', 1)">+</button>
            </div>
            <div id="num-bug" class="count-display">10</div>
            <div class="progress-container">
                <div id="bar-bug" class="progress-bar" style="background: var(--bug-col); width: 50%;"></div>
            </div>
            <div class="visual-pool" id="pool-bug"></div>
            <div style="color:#666; font-size:0.9em;">æ¯›èŸ²</div>
        </div>

        <div class="arrow">â”</div>

        <div class="column col-bird">
            <div class="role-name">æ¬¡ç´šæ¶ˆè²»è€…</div>
            <div class="species-icon">ğŸ¦</div>
            <div class="controls">
                <button class="ctrl-btn btn-minus" onclick="manualUpdate('bird', -1)">-</button>
                <button class="ctrl-btn btn-plus" onclick="manualUpdate('bird', 1)">+</button>
            </div>
            <div id="num-bird" class="count-display">5</div>
            <div class="progress-container">
                <div id="bar-bird" class="progress-bar" style="background: var(--bird-col); width: 25%;"></div>
            </div>
            <div class="visual-pool" id="pool-bird"></div>
            <div style="color:#666; font-size:0.9em;">ç´…è€³éµ¯</div>
        </div>

        <div class="arrow">â”</div>

        <div class="column col-cat">
            <div class="role-name">é ‚ç´šæ¶ˆè²»è€…</div>
            <div class="species-icon">ğŸˆ</div>
            <div class="controls">
                <button class="ctrl-btn btn-minus" onclick="manualUpdate('cat', -1)">-</button>
                <button class="ctrl-btn btn-plus" onclick="manualUpdate('cat', 1)">+</button>
            </div>
            <div id="num-cat" class="count-display">2</div>
            <div class="progress-container">
                <div id="bar-cat" class="progress-bar" style="background: var(--cat-col); width: 10%;"></div>
            </div>
            <div class="visual-pool" id="pool-cat"></div>
            <div style="color:#666; font-size:0.9em;">æµæµªè²“ / è›‡</div>
        </div>
    </div>

    <div class="scenario-panel">
        <div class="scenario-title">âš¡ å¤–ä¾†å› ç´ ï¼ˆé»æ“Šè§¸ç™¼äº‹ä»¶ï¼‰</div>
        <button class="action-btn btn-event-1" onclick="triggerEvent('pesticide')">â˜ ï¸ å™´ç‘æ®ºèŸ²åŠ‘</button>
        <button class="action-btn btn-event-2" onclick="triggerEvent('cats_invade')">ğŸˆ é‡è²“å¤§é‡å…¥ä¾µ</button>
        <button class="action-btn btn-event-3" onclick="triggerEvent('planting')">ğŸŒ³ æ¤æ¨¹æ—¥ (æ¢å¾©æ¤ç‰©)</button>
        <button class="action-btn" style="background:#607d8b" onclick="resetGame()">ğŸ”„ é‡ç½®ç”Ÿæ…‹</button>
    </div>

    <div id="game-over">
        <div style="font-size: 5em;">â˜ ï¸</div>
        <h2>ç”Ÿæ…‹å´©æ½°</h2>
        <p id="fail-reason">åŸå› ...</p>
        <button class="restart-btn" onclick="resetGame()">é‡æ–°é–‹å§‹</button>
    </div>

    <script>
        // === éŠæˆ²æ ¸å¿ƒæ•¸æ“š ===
        let eco = {
            plant: 20,
            bug: 10,
            bird: 5,
            cat: 2
        };
        
        // æœ€å¤§å€¼ (ç”¨æ–¼é¡¯ç¤ºé€²åº¦æ¢æ¯”ä¾‹)
        const MAX = 25;
        let gameActive = true;
        let tickerTimer;

        // åœ–ç¤ºåº«
        const icons = { plant: 'ğŸƒ', bug: 'ğŸ›', bird: 'ğŸ¦', cat: 'ğŸˆ' };

        // åˆå§‹åŒ–
        window.onload = function() {
            renderAll();
            // å•Ÿå‹•è‡ªå‹•ç”Ÿæ…‹å¾ªç’° (æ¯ 1.5 ç§’é‹ç®—ä¸€æ¬¡)
            setInterval(simulateEcosystem, 1500);
        };

        // === æ‰‹å‹•æ“ä½œ ===
        function manualUpdate(type, change) {
            if (!gameActive) return;
            eco[type] += change;
            if(eco[type] < 0) eco[type] = 0;
            renderAll();
            showNews(`ä½ ${change>0?'å¢åŠ ':'æ¸›å°‘'}äº†${getChiName(type)}çš„æ•¸é‡ã€‚`);
        }

        // === å¤–ä¾†å› ç´ äº‹ä»¶ ===
        function triggerEvent(eventType) {
            if (!gameActive) return;

            if (eventType === 'pesticide') {
                eco.bug = 0;
                eco.plant = Math.min(MAX, eco.plant + 5); // æ¤ç‰©ç¨å¾®æ¢å¾©
                showNews("âš ï¸ æ ¡å·¥å™´ç‘äº†æ®ºèŸ²åŠ‘ï¼æ¯›èŸ²å…¨éƒ¨æ­»äº¡ï¼");
            } 
            else if (eventType === 'cats_invade') {
                eco.cat += 5;
                showNews("âš ï¸ å­¸æ ¡é™„è¿‘ä¾†äº†ä¸€ç¾¤æµæµªè²“ï¼é ‚ç´šæ é£Ÿè€…å¢åŠ ï¼");
            }
            else if (eventType === 'planting') {
                eco.plant = 20;
                eco.bug = Math.min(MAX, eco.bug + 3); // èŸ²è·Ÿè‘—å›ä¾†ä¸€é»
                showNews("ğŸŒ³ æ¤æ¨¹æ—¥ï¼šç¨®æ¤äº†å¤§é‡æ–°æ¤ç‰©ï¼");
            }
            renderAll();
        }

        // === è‡ªå‹•ç”Ÿæ…‹å¾ªç’°é‚è¼¯ (é€™å°±æ˜¯ç‰©ç¨®äº’ç›¸å½±éŸ¿çš„æ ¸å¿ƒ) ===
        function simulateEcosystem() {
            if (!gameActive) return;

            let news = "";

            // 1. è²“ åƒ é³¥
            if (eco.cat > 0 && eco.bird > 0) {
                // å¦‚æœè²“å¤ªå¤šï¼Œé³¥æœƒè¢«åƒå¾ˆå¿«
                if (eco.cat > eco.bird) {
                    eco.bird = Math.max(0, eco.bird - 2);
                    news = "ğŸˆ è²“å¤ªå¤šäº†ï¼Œç´…è€³éµ¯è¢«å¤§é‡æ•é£Ÿï¼";
                } else if (Math.random() > 0.6) { // éš¨æ©Ÿæ•é£Ÿ
                    eco.bird--;
                    news = "ğŸˆ è²“æ‰äº†ä¸€éš»ç´…è€³éµ¯ã€‚";
                }
            } else if (eco.cat > 0 && eco.bird === 0) {
                // è²“æ²’é³¥åƒï¼Œè²“æœƒé¤“æ­»æˆ–é›¢é–‹
                if (Math.random() > 0.5) {
                    eco.cat--;
                    news = "ğŸˆ æ²’æœ‰é³¥å¯ä»¥æŠ“ï¼Œæµæµªè²“é¤“è‘—è‚šå­é›¢é–‹äº†...";
                }
            }

            // 2. é³¥ åƒ èŸ²
            if (eco.bird > 0 && eco.bug > 0) {
                if (eco.bird > eco.bug) {
                    eco.bug = Math.max(0, eco.bug - 2);
                    news = "ğŸ¦ é³¥ç¾¤æ­£åœ¨ç˜‹ç‹‚åƒèŸ²ï¼";
                } else if (Math.random() > 0.5) {
                    eco.bug--;
                }
            } else if (eco.bird > 0 && eco.bug === 0) {
                // é³¥æ²’èŸ²åƒï¼Œé¤“æ­»æˆ–é£›èµ°
                if (Math.random() > 0.5) {
                    eco.bird--;
                    news = "ğŸ¦ æ‰¾ä¸åˆ°æ¯›èŸ²ï¼Œç´…è€³éµ¯é£›èµ°å»åˆ¥çš„åœ°æ–¹è¦“é£Ÿäº†ã€‚";
                }
            }

            // 3. èŸ² åƒ æ¤ç‰©
            if (eco.bug > 0 && eco.plant > 0) {
                if (eco.bug > eco.plant) {
                    eco.plant = Math.max(0, eco.plant - 2);
                    news = "ğŸ› èŸ²ç½è­¦å ±ï¼æ¤ç‰©å¿«è¢«åƒå…‰äº†ï¼";
                } else if (Math.random() > 0.5) {
                    eco.plant--;
                }
            } else if (eco.bug > 0 && eco.plant === 0) {
                // èŸ²æ²’æ¤ç‰©åƒï¼Œé¤“æ­»
                eco.bug = Math.max(0, eco.bug - 3); // æ­»å¾ˆå¿«
                news = "ğŸ’€ æ¤ç‰©æ­»å…‰äº†ï¼Œæ¯›èŸ²æ­£åœ¨å¿«é€Ÿé¤“æ­»...";
            }

            // 4. æ¤ç‰©ç”Ÿé•· (å¦‚æœæ²’æœ‰å¤ªå¤šèŸ²ï¼Œæ¤ç‰©æœƒæ…¢æ…¢é•·å›ä¾†)
            if (eco.plant < 10 && eco.bug < 3) {
                eco.plant++;
                // news = "ğŸŒ¿ æ¤ç‰©æ­£åœ¨æ…¢æ…¢ç”Ÿé•·...";
            }

            renderAll();
            if(news) showNews(news);
            checkGameOver();
        }

        // === æ¸²æŸ“ç•«é¢ ===
        function renderAll() {
            for (let type in eco) {
                let val = eco[type];
                
                // æ•¸å­—
                document.getElementById(`num-${type}`).innerText = val;
                
                // é€²åº¦æ¢
                let pct = Math.min(100, (val / MAX) * 100);
                document.getElementById(`bar-${type}`).style.width = pct + "%";
                
                // åœ–ç¤ºæ±  (é™åˆ¶é¡¯ç¤ºæ•¸é‡ä»¥å…ç•«é¢çˆ†ç‚¸)
                let pool = document.getElementById(`pool-${type}`);
                pool.innerHTML = "";
                let displayCount = Math.min(val, 18);
                for(let i=0; i<displayCount; i++) {
                    let span = document.createElement("span");
                    span.className = "mini-icon";
                    span.innerText = icons[type];
                    // æ¤ç‰©è®ŠåŒ–å°å½©è›‹
                    if(type === 'plant' && i % 3 === 0) span.innerText = 'ğŸŒº';
                    if(type === 'cat' && i % 2 === 0) span.innerText = 'ğŸ'; // å¶çˆ¾å‡ºç¾è›‡
                    pool.appendChild(span);
                }
            }
        }

        // === æª¢æŸ¥éŠæˆ²çµæŸ ===
        function checkGameOver() {
            // æƒ…å¢ƒ 1: ç”Ÿç”¢è€…æ»…çµ•
            if (eco.plant === 0 && eco.bug === 0 && eco.bird === 0) {
                triggerGameOver("ã€å®Œå…¨æ­»å¯‚ã€‘\næ¤ç‰©æ­»å…‰äº†ï¼Œæ¥è‘—æ‰€æœ‰å‹•ç‰©ä¹Ÿå› ç‚ºé£¢è’è€Œå…¨éƒ¨æ»…çµ•ã€‚\næ ¡åœ’è®Šæˆäº†ä¸€ç‰‡æ­»å¯‚çš„è’åœ°ã€‚");
            }
            // æƒ…å¢ƒ 2: é ‚ç´šæ é£Ÿè€…éå‰©å°è‡´å´©æ½°
            else if (eco.cat > 15 && eco.bird === 0) {
                triggerGameOver("ã€ç”Ÿæ…‹å¤±è¡¡ã€‘\nè²“/è›‡çš„æ•¸é‡å¤ªå¤šï¼ŒæŠŠæ‰€æœ‰çš„é³¥éƒ½åƒå…‰äº†ï¼\næ¥ä¸‹ä¾†è²“ä¹Ÿæœƒå› ç‚ºæ²’æœ‰é£Ÿç‰©è€Œé¤“æ­»ã€‚");
            }
            // æƒ…å¢ƒ 3: èŸ²ç½å°è‡´ä¸å¯é€†
            else if (eco.bug > 20 && eco.plant === 0) {
                triggerGameOver("ã€èŸ²ç½æ¯€æ»…ã€‘\næ¯›èŸ²å¾¹åº•åƒå…‰äº†æ ¡åœ’çš„æ¤ç‰©ã€‚\næ²’æœ‰æ¤ç‰©ï¼Œæ°§æ°£æ¸›å°‘ï¼Œä¸”æ¯›èŸ²æœ€çµ‚ä¹Ÿæœƒé›†é«”é¤“æ­»ã€‚");
            }
        }

        function triggerGameOver(reason) {
            gameActive = false;
            document.getElementById('fail-reason').innerText = reason;
            document.getElementById('game-over').style.display = "flex";
        }

        function resetGame() {
            eco = { plant: 20, bug: 10, bird: 5, cat: 2 };
            gameActive = true;
            document.getElementById('game-over').style.display = "none";
            renderAll();
            showNews("ç”Ÿæ…‹ç³»çµ±å·²é‡ç½®ï¼Œæº–å‚™é–‹å§‹ï¼");
        }

        // === å·¥å…·å‡½æ•¸ ===
        function showNews(text) {
            let ticker = document.getElementById('news-ticker');
            ticker.innerText = text;
            ticker.style.animation = "none";
            ticker.offsetHeight; /* trigger reflow */
            ticker.style.animation = "popIn 0.5s";
        }

        function getChiName(type) {
            const names = { plant: 'æ¤ç‰©', bug: 'æ¯›èŸ²', bird: 'ç´…è€³éµ¯', cat: 'è²“' };
            return names[type];
        }

    </script>
</body>
</html>